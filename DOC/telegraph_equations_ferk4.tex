\documentclass[12pt, letterpaper]{article}
\usepackage{graphicx} % Required for inserting images
\usepackage{amsmath}
\usepackage{mdframed}
\usepackage{amssymb}

\title{telegraph equations solved with MFEM library using MFEM}
\author{Denis Lachapelle}
\date{June 2025}

\setlength{\parindent}{0pt}

\begin{document}

\maketitle

\section{Introduction}
This document explains the telegraph equations simulation using finite difference method based on MFEM library.
  
  
  \section{Theory, a second trial}
  V is approximated in H1 space and I in L2 space.
  
  \subsection{From Telegrah PDE to Matrix form}
  
  The telegraph equations are:
  
  \begin{equation}\frac{\partial{V}}{\partial{x}} + L \frac{\partial{I}}{\partial{t}} + R I = 0\end{equation}
  
  
  \begin{equation}\frac{\partial{I}}{\partial{x}} + C \frac{\partial{V}}{\partial{t}} + G V = 0\end{equation}
  
  For now assumes a single line from points a to b.\\
  
Going to weak form using space H1 for V ($\phi$) and  L2 for I ($\psi$). Note the test functions span the entire domain and is zero on the border and the equations below have to be true for all test functions. Look at "element\_finis.pdf" p. 42.

\begin{equation}\int_\Omega(\frac{\partial{V}}{\partial{x}} + L \frac{\partial{I}}{\partial{t}} + R I) \phi_i = 0\end{equation}

\begin{equation}\int_\Omega(\frac{\partial{I}}{\partial{x}} + C \frac{\partial{V}}{\partial{t}} + G V) \psi_i = 0\end{equation}

and then


\begin{equation}
	\int_\Omega\frac{\partial{V}}{\partial{x}} \phi_i
	+ \int_\Omega(L \frac{\partial{I}}{\partial{t}} +  R I) \phi_i
	= 0
\end{equation}



\begin{equation}
	\int_\Omega\frac{\partial{I}}{\partial{x}} \psi_i
	+ \int_\Omega(C \frac{\partial{V}}{\partial{t}} +  G V) \psi_i
	= 0
\end{equation}

Using integration by part on the first term...

\begin{equation}\int_a^b u(x) v'(x) \, dx = \Big[u(x) v(x)\Big]_a^b - \int_a^b u'(x) v(x) \, dx\end{equation}

Each equations becomes ...

\begin{equation}
	\Big[\phi_i V \Big]_a^b
	-\int_\Omega(V \frac{\partial{\phi_i}}{\partial{x}})
	+ \int_\Omega(L \frac{\partial{I}}{\partial{t}} +  R I) \phi_i
	= 0
\end{equation}

\begin{equation}
	\Big[\psi_i I \Big]_a^b
	-\int_\Omega(I \frac{\partial{\psi_i}}{\partial{x}})
	+ \int_\Omega(C \frac{\partial{V}}{\partial{t}} +  G V) \psi_i
	= 0
\end{equation}

Then we approximate V and I, V(x) by

\begin{equation}V(x, t) = \sum_j V_j(t) \phi_j(x) \end{equation}

and I(x) by 

\begin{equation}I(x, t) = \sum_j I_j(t) \psi_j(x) \end{equation}



Equations (8) becomes ...

\begin{equation}
	\Big[\phi_i \sum_j V_j(t) \phi_j(x) \Big]_a^b
	- \int_{\Omega_i} \sum_j V_j \phi_j \frac{\partial{\phi_i}}{\partial{x}} 
	+ L \int_{\Omega_i} \frac{\partial{}}{\partial t} \Big[ \sum{I_j} \psi_j \Big] \phi_i
	+  R \int_{\Omega_i} \sum_j I_j \psi_j \phi_i
	= 0
\end{equation}

Assume $\frac{\partial{I}}{\partial{t}}$ is constant on each element so we can exclude $\frac{\partial{I}}{\partial{t}}$ from inside the integral and interchange the integral and summation.

\begin{equation}
	\Big[\phi_i \sum_j V_j(t) \phi_j(x) \Big]_a^b
	-\sum_j V_j \int_{\Omega_i}\phi_j \frac{\partial{\phi_i}}{\partial{x}} 
	+ L \sum_j \frac{\partial{I_j}}{\partial t} \int_{\Omega_i} \psi_j \phi_i
	+  R \sum_j I_j \int_{\Omega_i} \psi_j \phi_i
	= 0
\end{equation}

and equation 9 becomes ...

\begin{equation}
	\Big[\psi_i \sum_j I_j(t) \psi_j(x) \Big]_a^b
	- \sum_j I_j  \int_\Omega \psi_j \frac{\partial{\psi_i}}{\partial{x}}
	+ C \sum_j \frac{\partial{V_j}}{\partial{t}} \int_\Omega \phi_j \psi_i
	+ G \sum_j V_j \int_\Omega \phi_j \psi_i
	= 0
\end{equation}

So now we have two equations (13) and (14) with unknown $V_j(t)$ and $I_j(t)$.\\

The term $\Big[\phi_i \sum_j V_j(t) \phi_j(x) \Big]_a^b$ is $\phi_{N-1}(b) V(b, t) - \phi_0(a) V(a, t) $.\\

The term $\Big[\psi_i \sum_j I_j(t) \psi_j(x) \Big]_a^b$ is $\psi_{N-1}(b) I(b, t) - \psi_0(a) I(a, t) $.\\

The j span the trial functions (Approximating Functions) and the i span the elements. The equations can be converted in matrix form...

\begin{equation}
	\phi_i(b) V(b, t) - \phi_i(a) V(a, t) - S_V V + L M_V \frac{\partial I}{\partial t} + R M_V I = 
	= 0
\end{equation}

\begin{equation}
	\psi_i(b) I(b, t) - \psi_i(a) I(a, t) - S_I I + C M_I \frac{\partial V}{\partial t} + G M_I V = 
	= 0
\end{equation}

Where ...

\[S_V = \int_\Omega \phi_j \frac{\partial \phi_i}{\partial x}\]
dimensions VDOFxVDOF

\[M_V = \int_\Omega \psi_j \phi_i\]
dimension VDOFxIDOF

\[S_I = \int_\Omega \psi_j \frac{\partial \psi_i}{\partial x}\]
dimension IDOFxIDOF

\[M_I = \int_\Omega \phi_j \psi_i\]
dimension IDOFxVDOF\\

We can then isolate $L M_V \frac{\partial I}{\partial t}$ and $C M_I \frac{\partial V}{\partial t}$  on the right.



\begin{equation}
	L M_V \frac{\partial I}{\partial t} = - R M_V I + S_V V - \phi_i(b) V(b, t) + \phi_i(a) V(a, t)
\end{equation}

\begin{equation}
	C M_I \frac{\partial V}{\partial t} =  - G M_I V + S_I I - \psi_i(b) I(b, t) + \psi_i(a) I(a, t)
\end{equation}

The combine block matrix will be ...

\begin{equation}
	\begin{bmatrix}
		C M_I & 0 \\
		0   & L M_V
	\end{bmatrix}
	\begin{bmatrix}
		
		\frac{\partial{V}}{\partial{t}} \\
		\frac{\partial{I}}{\partial{t}} \\
	\end{bmatrix}
	=
	\begin{bmatrix}
		 - G M_I & S_I\\
		S_V &  - R M_V\\
				
	\end{bmatrix}
	\begin{bmatrix}
		V \\
		I \\
	\end{bmatrix}
	+
	\begin{bmatrix}
	-Fi \\
	-Fv \\
\end{bmatrix}	
\end{equation}

For the source Vs Rs, Fi shall have element 0 (x=a) $ - \psi_i(a) I(a, t)$ where I(a, t) is $\frac{V_S-V_0}{Rs}$ so it becomes $ - \psi_i(a) \frac{V_S-V_0}{Rs}$ and split in two $ - \psi_i(a) \frac{V_S}{Rs}  + \psi_i(a) \frac{V_0}{Rs}$. The term in $V_S$ is a forcing function and need to be an added linear form (column vector) in place of 
$Fi$.
The term in $V_0$ shall be assemble as a linear form and added to $A_{00}$ row 0. \\

Just rewrite the equation with named submatrix.

\begin{equation}
	\begin{bmatrix}
		C M_I & 0 \\
		0   & L M_V
	\end{bmatrix}
	\begin{bmatrix}
		
		\frac{\partial{V}}{\partial{t}} \\
		\frac{\partial{I}}{\partial{t}} \\
	\end{bmatrix}
	=
	\begin{bmatrix}
		B0\\
		B1\\
	\end{bmatrix}	
\end{equation}

The equations are then independants:

\begin{equation}
	C M_I \frac{\partial{V}}{\partial{t}}
	= B0	
\end{equation}


\begin{equation}
	L M_V \frac{\partial{I}}{\partial{t}}
	= B1	
\end{equation}

These two equations shall be solved separately.
The first one is overdetermined while the second is underdetermined.\\

\[
A^T A x = A^T b
\]


DL250625: je suis blocqué la système ne donne pas de bon résultats, et je n'arrive pas à faire un preconditionner. Je dois prendre un break.\\

Je retourne avec H1 et L2 puis je vais demander de l'aide sur mfem issues.\\


DL250709: New approach, I will work in 2D one dimensions being x and the other being time, so no need for runge kuta.



\subsection{Source Boundary Condition}

To add the voltage source Vs with Rs we should add the current I caused by (Vs-Va)/Rs to Va.\\

Firstly add the current source caused by Vs/Rs, so to the rhs node vector element 0 of I add the contribution Vs/Rs. Units are OK because Vs/Rs gives Ampere.\\

Secondly add to the coupling matrix (RHS matrix) the contribution of $R_s$ to account for $V_0$ caused current. So to $I_0$ row (A10) add to first element $-\frac{1}{R_s}$. Physical unit check; $S_V$ is a weight without unit so  $S_V V$ are Volt and $\frac{V}{R_s}$ unit is Volt.

\begin{equation}
	\begin{bmatrix}
		C M & 0 \\
		0   & L M
	\end{bmatrix}
	\begin{bmatrix}
		
		\frac{\partial{V}}{\partial{t}} \\
		\frac{\partial{I}}{\partial{t}} \\
	\end{bmatrix}
	=
	\left[
	\begin{bmatrix}
		- G M & S_I\\
		S_V & - R M\\
	\end{bmatrix}
	+
		\begin{bmatrix}
		0 & 0 \\
		\vdots & \vdots \\
		-\frac{1}{R_s} & 0 \\
		0 & 0 \\
		\vdots & \vdots \\
	\end{bmatrix}
	\right]
	\left[
	\begin{bmatrix}
		V \\
		I \\
	\end{bmatrix}
	+
	\begin{bmatrix}
		0 \\
		\frac{V_S}{R_s} \\
		0
	\end{bmatrix}
	\right]
\end{equation}

\subsection{Load Boundary Condition}

Add to the coupling matrix the current caused by Rl. This will be the element row  nbrDof-1, col nbrDof-1 of $S_V$.

\begin{equation}
	\begin{bmatrix}
		C M & 0 \\
		0   & L M
	\end{bmatrix}
	\begin{bmatrix}
		
		\frac{\partial{V}}{\partial{t}} \\
		\frac{\partial{I}}{\partial{t}} \\
	\end{bmatrix}
	=
	\left[
	\begin{bmatrix}
		- G M & S_I\\
		S_V & - R M\\
	\end{bmatrix}
	+
	\begin{bmatrix}
		0 & 0 \\
		\vdots & \vdots \\
		-\frac{1}{R_s} ... & 0 \\
		0 & 0 \\
		\vdots & \vdots \\
	\end{bmatrix}
	+
	\begin{bmatrix}
		0 & 0 \\
		\vdots & \vdots \\
		... -\frac{1}{R_L} & 0 \\
		0 & 0 \\
		\vdots & \vdots \\
	\end{bmatrix}
	\right]
	\left[
	\begin{bmatrix}
		V \\
		I \\
	\end{bmatrix}
	+
	\begin{bmatrix}
		0 \\
		\frac{V_S}{R_s} \\
		0
	\end{bmatrix}
	\right]
\end{equation}

Let check the units to make sure the BC make sense.



\subsection{C++/MFEM Implementation}

The software is name stltferk4.cpp.

Instead of using the MFEM class to add BC I modify the sparse matrix directly.\\

\subsubsection{MV Matrix}
The MV matrix is made this way:\\
MV = new MixedBilinearForm(IFESpace, VFESpace);\\
MV->AddDomainIntegrator(new MixedScalarMassIntegrator(one));\\
which made the following operator $(\lambda u,v)$.\\

\subsubsection{MI Matrix}
MI = new MixedBilinearForm(VFESpace, IFESpace);\\
MI->AddDomainIntegrator(new MixedScalarMassIntegrator(one));\\

\subsubsection{$S_V$ Matrix}
The $S_V$ Matrix is made with:\\
SV = new BilinearForm(VFESpace);\\
SV->AddDomainIntegrator(new DerivativeIntegrator(one, 0));\\

Which one implement the following operator: $(\lambda \frac{du}{dx_i}, v)$

\subsubsection{$S_I$ Matrix}
The $S_I$ Matrix is made with:\\
SI = new BilinearForm(IFESpace);\\
SI->AddDomainIntegrator(new DerivativeIntegrator(one, 0));\\

Which one implement the following operator: $(\lambda \frac{du}{dx_i}, v)$

\section{ A Different Approach}
Since it did not work with the above approach I think we can solve the equations assuming time t is another space dimension, so the first order coupled telegrapher equations will become like 2D PDE. There won't be time stepping since the space t will be all solved at once.\\

\subsection{From Telegrah PDE to Matrix form}

The telegraph equations are:

\begin{equation}\frac{\partial{V}}{\partial{x}} + L \frac{\partial{I}}{\partial{t}} + R I = 0\end{equation}


\begin{equation}\frac{\partial{I}}{\partial{x}} + C \frac{\partial{V}}{\partial{t}} + G V = 0\end{equation}

Now we change t for y, a space dimensions.\\

Going to weak form using space H1 for V ($\phi$) and  L2 for I ($\psi$). 

\begin{equation}\int_\Omega(\frac{\partial{V(x, y)}}{\partial{x}} + L \frac{\partial{I(x,y)}}{\partial{y}} + R I(x,y)) \phi_i = 0\end{equation}

\begin{equation}\int_\Omega(\frac{\partial{I(x,y)}}{\partial{x}} + C \frac{\partial{V(x,y)}}{\partial{y}} + G V(x,y)) \psi_i = 0\end{equation}

and then


\begin{equation}
	\int_\Omega\frac{\partial{V(x,y)}}{\partial{x}} \phi_i
	+ \int_\Omega(L \frac{\partial{I(x,y)}}{\partial{y}}) \phi_i
	+ \int_\Omega( R I(x,y)) \phi_i
	= 0
\end{equation}



\begin{equation}
	\int_\Omega\frac{\partial{I(x,y)}}{\partial{x}} \psi_i
	+ \int_\Omega(C \frac{\partial{V(x,y)}}{\partial{y}}) \psi_i
	+  \int_\Omega (G V(x,y)) \psi_i
	= 0
\end{equation}

From the two above equations we can select the proper bilinear integrator for each terms and deduct the boundary conditions.

\begin{itemize}
	\item Bilinear DerivativeIntegrator in x direction
	\item MixedBilinear DerivativeIntegrator in y direction, test functions in VFESpace.
	\item MixedBilinear MixedScalarMassIntegrator, test functions in VFESpace.
\end{itemize}

\begin{equation}
	\begin{bmatrix}
		BLFdvdx & MBLFIV \\
		MBLFVI   & BLFdidx
	\end{bmatrix}
	\begin{bmatrix}
		
		V\\
		I
	\end{bmatrix}
	=
	\begin{bmatrix}
		?\\
		?
		
	\end{bmatrix}	
\end{equation}

Boundary condition shall be applied on all dof of I(0, y). Don't forget y is time.\\

$ I(0,y) = \frac{V_s(y) - V(0,y)}{Rs} $ \\

This equation (in weak form) can be added to the block matrix to enforce the VSRS boundary condition. A new set of blocks shall be added to our block system.\\

A submesh shall be made for the added domain from the boundary vertices, let name it ISFESpace.\\

The weak form ...\\

$ \int{( I(0,y) - \frac{V_s(y)}{Rs} + \frac{V(0,y)}{Rs}) \lambda	dy} = 0$ \\

$ \int{ I(0,y) \lambda dy }  + \int{\frac{V(0,y)}{Rs} \lambda dy} =  \int{ \frac{V_s(y)}{Rs})\lambda dy}$ \\

\begin{equation}
	\begin{bmatrix}
		BLFdvdx & MBLFIV \\
		MBLFVI   & BLFdidx \\
		A & B
	\end{bmatrix}
	\begin{bmatrix}
		
		V\\
		I
	\end{bmatrix}
	=
	\begin{bmatrix}
		?\\
		?\\
		C
	\end{bmatrix}	
\end{equation}

This system is over-determined and need to be solved using least square approach which is not included in MFEM. Also a weight may need to be added to A, B and C to change the relative size of to the error contribution. A prefer method is the saddle point approach.\\

\subsection{Adding the VSRS Boundary Condition Using the Saddle Point Approach}

From this equation\\

\[
	\begin{bmatrix}
		BLFdvdx & MBLFIV \\
		MBLFVI   & BLFdidx
	\end{bmatrix}
	\begin{bmatrix}
		
		V\\
		I
	\end{bmatrix}
	=
	\begin{bmatrix}
		0\\
		0
		
	\end{bmatrix}	
\]


we should add the VSRS BC\\
\[
\begin{bmatrix}
	BLFdvdx & MBLFIV & MBLFV\lambda^T\\
	MBLFVI   & BLFdidx & MBLFI\lambda^T\\
	MBLFV\lambda & MBLFI\lambda & 0
\end{bmatrix}
\begin{bmatrix}
	
	V\\
	I\\
	\lambda
\end{bmatrix}
=
\begin{bmatrix}
	0\\
	\\
	LFVS
\end{bmatrix}	
\]

MBLFVL is a mixed bilinear form with mixed scalar mass integrator with coefficient 1/Rs.\\

MBLFIL is a mixed bilinear form with mixed scalar mass integrator with coefficient 1.\\

LFVS is a linear form with DomainLFIntegrator with a coefficient $\frac{V_s(y)}{Rs}$.\\


  

 is the method of


Using integration by part on the first term...

\begin{equation}\int_a^b u(x) v'(x) \, dx = \Big[u(x) v(x)\Big]_a^b - \int_a^b u'(x) v(x) \, dx\end{equation}

Each equations becomes ...

\begin{equation}
	\Big[\phi_i V \Big]_a^b
	-\int_\Omega(V \frac{\partial{\phi_i}}{\partial{x}})
	+ \int_\Omega(L \frac{\partial{I}}{\partial{t}} +  R I) \phi_i
	= 0
\end{equation}

\begin{equation}
	\Big[\psi_i I \Big]_a^b
	-\int_\Omega(I \frac{\partial{\psi_i}}{\partial{x}})
	+ \int_\Omega(C \frac{\partial{V}}{\partial{t}} +  G V) \psi_i
	= 0
\end{equation}



\section*{Canonical Saddle Point System}
This section was generated using chatGPT.

The canonical form of a saddle point system is:

\[
\begin{bmatrix}
	A & B^T \\
	B & 0
\end{bmatrix}
\begin{bmatrix}
	x \\
	\lambda
\end{bmatrix}
=
\begin{bmatrix}
	f \\
	g
\end{bmatrix}
\]

Where:
\begin{itemize}
	\item \( x \in \mathbb{R}^n \): primary unknown (e.g., field variable)
	\item \( \lambda \in \mathbb{R}^m \): Lagrange multiplier or constraint variable
	\item \( A \in \mathbb{R}^{n \times n} \): typically symmetric positive (semi)definite
	\item \( B \in \mathbb{R}^{m \times n} \): constraint matrix
	\item \( f \in \mathbb{R}^n \), \( g \in \mathbb{R}^m \): right-hand side vectors
\end{itemize}

Expanding the system yields:

\[
\begin{aligned}
	A x + B^T \lambda &= f \\
	B x &= g
\end{aligned}
\]

\subsection*{Origin: Constrained Minimization}

Consider the constrained minimization problem:

\[
\min_{x \in \mathbb{R}^n} \left( \frac{1}{2} x^T A x - f^T x \right)
\quad \text{subject to } B x = g
\]

The Lagrangian is:

\[
\mathcal{L}(x, \lambda) = \frac{1}{2} x^T A x - f^T x + \lambda^T (B x - g)
\]

The first-order optimality conditions are:

\[
\begin{aligned}
	\nabla_x \mathcal{L} &= A x - f + B^T \lambda = 0 \\
	\nabla_\lambda \mathcal{L} &= B x - g = 0
\end{aligned}
\]

Which again gives the saddle point system:

\[
\begin{bmatrix}
	A & B^T \\
	B & 0
\end{bmatrix}
\begin{bmatrix}
	x \\
	\lambda
\end{bmatrix}
=
\begin{bmatrix}
	f \\
	g
\end{bmatrix}
\]

 

\end{document}
